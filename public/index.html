<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="static/css/main.css">
    <script id="shaderVs" type="x-shader/x-vertex">
        precision highp float;
        attribute vec3 vertPosition;
        attribute vec3 vertNormal;
        attribute vec2 vertTexture;
        
        varying vec2 vTextureCoord;
        varying highp vec3 vLighting;
        
        varying vec3 w_pos;
        varying vec3 w_nv;
        varying vec2 o_uv;

        uniform mat4 mWorld;
        uniform mat4 mView;
        uniform mat4 mProj;
        uniform mat4 mNorm;

        void main() {
            vTextureCoord = vertTexture;
            vec4 worldPos = mWorld * vec4(vertPosition, 1.0);
            gl_Position = mProj * mView * worldPos;

            highp vec3 ambientLight = vec3(0.3, 0.3, 0.3);
            highp vec3 directionalLightColor = vec3(1, 1, 1);
            highp vec3 directionalVector = normalize(vec3(0.85, 0.8, 0.75));
            highp vec4 transformedNormal = mNorm * vec4(vertNormal, 1);
            highp float directional = max(dot(transformedNormal.xyz, directionalVector), 0.0);
            vLighting = ambientLight + (directionalLightColor * directional);
            o_uv = vertTexture;
            w_nv = normalize(mat3(mWorld) * vertNormal);
            w_pos = worldPos.xyz;

        }
    </script>
    
    <script id="shaderFs" type="x-shader/x-fragment">
        #extension GL_OES_standard_derivatives : enable
        precision mediump float;

        varying highp vec2 vTextureCoord;
        varying highp vec3 vLighting;

        varying vec3 w_pos;
        varying vec3 w_nv;
        varying vec2 o_uv;

        uniform vec3 u_light_pos;
        uniform sampler2D u_diffuse;
        uniform sampler2D u_normal_map;

        uniform sampler2D uSampler;

        uniform bool stateShade;
        uniform int mode;

        void main() {
            if (stateShade) {
                if (mode == 0) {
                    highp vec4 texelColor = texture2D(uSampler, vTextureCoord);
                    gl_FragColor = vec4(texelColor.rgb * vLighting, texelColor.a);
                }
                else if (mode == 1) {
                    vec3 N = normalize(w_nv);
                    vec3 dp1 = dFdx(w_pos);
                    vec3 dp2 = dFdy(w_pos);
                    vec2 duv1 = dFdx(o_uv);
                    vec2 duv2 = dFdy(o_uv);
                    vec3 dp2perp = cross(dp2, N);
                    vec3 dp1perp = cross(N, dp1);
                    vec3 T = dp2perp * duv1.x + dp1perp * duv2.x;
                    vec3  B       = dp2perp * duv1.y + dp1perp * duv2.y;
                    float invmax  = inversesqrt(max(dot(T, T), dot(B, B)));
                    mat3  tm      = mat3(T * invmax, B * invmax, N);
                    mat3  tbn_inv = mat3(vec3(tm[0].x, tm[1].x, tm[2].x), vec3(tm[0].y, tm[1].y, tm[2].y), vec3(tm[0].z, tm[1].z, tm[2].z));

                    vec3  L    = tbn_inv * normalize(u_light_pos - w_pos);
                    vec3  mapN = normalize(texture2D(u_normal_map, o_uv.st).xyz * 2.0 - 1.0); 
                    float kd   = max(0.0, dot(mapN, L));

                    vec3 color     = texture2D(u_diffuse, o_uv.st).rgb;
                    vec3 light_col = (0.0 + kd) * color.rgb;
                    gl_FragColor   = vec4(clamp(light_col, 0.0, 1.0) * vLighting, 1.0);
                }
            } else {
                highp vec4 texelColor = texture2D(uSampler, vTextureCoord);
                gl_FragColor = vec4(texelColor.rgb * vec3(1, 1, 1), texelColor.a);
            }
        }
    </script>
    <script>
        function help() {
            var x = document.getElementById("helpText");
            if (x.style.display === "none") {
                x.style.display = "block";
            } else {
                x.style.display = "none";
            }
        }
    </script>
    <script type="module" src="static/js/script.js"></script>
    <title>Document</title>
</head>
<body>
    <a id="download-link" style="display:none"></a>
    <input style="display: none;" type="file" id="upload-btn" value="Select Files">
    <div style="display:flex; flex-direction:row">
        <div style="margin-right:5px;">
            <canvas id="glCanvas" width="640" height="640"></canvas>
        </div>
        <div>
            <div>
                <button type="button" id="reset">Reset View</button>
            </div>
            <div>
                <button type="button" id="ortho">Orthographic</button>
                <button type="button" id="oblique">Oblique</button>
                <button type="button" id="perspective">Perspective</button>
            </div>
            <div>
                <button type="button" id="shade" value="On" >Shading</button>
                <button type="button" id="save">Save</button>
                <button type="button" id="load">Load</button>
            </div>
            <div>
                <label>Camera Rotate X</label>
                <input type="range" min="-180" max="180" value="0" class="slider" id="cameraRotateX">
            </div>
            <div>
                <label>Camera Rotate Y</label>
                <input type="range" min="-180" max="180" value="0" class="slider" id="cameraRotateY">
            </div>

            <div>
                <div>
                    <label>Movement</label>
                </div>
                <input type="range" min="-10" max="10" value="0" class="slider" id="movex">
                <input type="range" min="-10" max="10" value="0" class="slider" id="movey">
                <input type="range" min="-10" max="10" value="0" class="slider" id="movez">
            </div>
            <div>
                <div>
                    <label>Eye</label>
                </div>
                <input type="range" min="-10" max="10" value="0" class="slider" id="eyex">
                <input type="range" min="-10" max="10" value="0" class="slider" id="eyey">
                <input type="range" min="-10" max="10" value="-8" class="slider" id="eyez">
            </div>
            <div>
                <div>
                    <label>Center</label>
                </div>
                <input type="range" min="-10" max="10" value="0" class="slider" id="centerx">
                <input type="range" min="-10" max="10" value="0" class="slider" id="centery">
                <input type="range" min="-10" max="10" value="0" class="slider" id="centerz">
            </div>
            <div>
                <div>
                    <label>Up</label>
                </div>
                <input type="range" min="-10" max="10" value="0" class="slider" id="upx">
                <input type="range" min="-10" max="10" value="1" class="slider" id="upy">
                <input type="range" min="-10" max="10" value="0" class="slider" id="upz">
            </div>
            <div>
                <div>
                    <label>Giraffe Translation</label>
                </div>
                <input type="range" min="-10" max="10" value="0" class="slider" id="gTx">
                <input type="range" min="-10" max="10" value="0" class="slider" id="gTy">
                <input type="range" min="-10" max="10" value="0" class="slider" id="gTz">
            </div>
            <div>
                <div>
                    <label>Giraffe Neck Rotation</label>
                </div>
                <input type="range" min="-20" max="20" value="0" class="slider" id="gRNx">
                <input type="range" min="-20" max="20" value="0" class="slider" id="gRNy">
                <input type="range" min="-20" max="20" value="0" class="slider" id="gRNz">
            </div>
            <div>
                <div>
                    <label>Giraffe Head Rotation</label>
                </div>
                <input type="range" min="-20" max="20" value="0" class="slider" id="gHx">
                <input type="range" min="-20" max="20" value="0" class="slider" id="gHy">
                <input type="range" min="-20" max="20" value="0" class="slider" id="gHz">
            </div>
            <div>
                <div>
                    <label>Giraffe Leg Front Left Rotation</label>
                </div>
                <input type="range" min="-20" max="20" value="0" class="slider" id="gLFLx">
                <input type="range" min="-20" max="20" value="0" class="slider" id="gLFLy">
                <input type="range" min="-20" max="20" value="0" class="slider" id="gLFLz">
            </div>
            <div>
                <div>
                    <label>Giraffe Leg Front Right Rotation</label>
                </div>
                <input type="range" min="-20" max="20" value="0" class="slider" id="gLFRx">
                <input type="range" min="-20" max="20" value="0" class="slider" id="gLFRy">
                <input type="range" min="-20" max="20" value="0" class="slider" id="gLFRz">
            </div>
            <div>
                <div>
                    <label>Giraffe Leg Back Left Rotation</label>
                </div>
                <input type="range" min="-20" max="20" value="0" class="slider" id="gLBLx">
                <input type="range" min="-20" max="20" value="0" class="slider" id="gLBLy">
                <input type="range" min="-20" max="20" value="0" class="slider" id="gLBLz">
            </div>
            <div>
                <div>
                    <label>Giraffe Leg Back Right Rotation</label>
                </div>
                <input type="range" min="-20" max="20" value="0" class="slider" id="gLBRx">
                <input type="range" min="-20" max="20" value="0" class="slider" id="gLBRy">
                <input type="range" min="-20" max="20" value="0" class="slider" id="gLBRz">
            </div>
            <div>
                <div>
                    <label>Giraffe Animation</label>
                </div>
                <input type="range" min="-20" max="20" value="0" class="slider" id="giraffeRot">
                <button type="button" id="giraffeAnimate">animate</button>
            </div>
            <div>
                <div>
                    <label>Dog Translation</label>
                </div>
                <input type="range" min="-10" max="10" value="0" class="slider" id="dTx">
                <input type="range" min="-10" max="10" value="0" class="slider" id="dTy">
                <input type="range" min="-10" max="10" value="0" class="slider" id="dTz">
            </div>
            <div>
                <div>
                    <label>Dog Neck Rotation</label>
                </div>
                <input type="range" min="-20" max="20" value="0" class="slider" id="dRNx">
                <input type="range" min="-20" max="20" value="0" class="slider" id="dRNy">
                <input type="range" min="-20" max="20" value="0" class="slider" id="dRNz">
            </div>
            <div>
                <div>
                    <label>Dog Head Rotation</label>
                </div>
                <input type="range" min="-20" max="20" value="0" class="slider" id="dHx">
                <input type="range" min="-20" max="20" value="0" class="slider" id="dHy">
                <input type="range" min="-20" max="20" value="0" class="slider" id="dHz">
            </div>
            <div>
                <div>
                    <label>Dog Leg Front Left Rotation</label>
                </div>
                <input type="range" min="-20" max="20" value="0" class="slider" id="dLFLx">
                <input type="range" min="-20" max="20" value="0" class="slider" id="dLFLy">
                <input type="range" min="-20" max="20" value="0" class="slider" id="dLFLz">
            </div>
            <div>
                <div>
                    <label>Dog Leg Front Right Rotation</label>
                </div>
                <input type="range" min="-20" max="20" value="0" class="slider" id="dLFRx">
                <input type="range" min="-20" max="20" value="0" class="slider" id="dLFRy">
                <input type="range" min="-20" max="20" value="0" class="slider" id="dLFRz">
            </div>
            <div>
                <div>
                    <label>Dog Leg Back Left Rotation</label>
                </div>
                <input type="range" min="-20" max="20" value="0" class="slider" id="dLBLx">
                <input type="range" min="-20" max="20" value="0" class="slider" id="dLBLy">
                <input type="range" min="-20" max="20" value="0" class="slider" id="dLBLz">
            </div>
            <div>
                <div>
                    <label>Dog Leg Back Right Rotation</label>
                </div>
                <input type="range" min="-20" max="20" value="0" class="slider" id="dLBRx">
                <input type="range" min="-20" max="20" value="0" class="slider" id="dLBRy">
                <input type="range" min="-20" max="20" value="0" class="slider" id="dLBRz">
            </div>
            <div>
                <div>
                    <label>Dog Tail Rotation</label>
                </div>
                <input type="range" min="-20" max="20" value="0" class="slider" id="dTailx">
                <input type="range" min="-20" max="20" value="0" class="slider" id="dTaily">
                <input type="range" min="-20" max="20" value="0" class="slider" id="dTailz">
            </div>
            <div>
            <div>
                <div>
                    <label>Dog Animation</label>
                </div>
                <input type="range" min="-20" max="20" value="0" class="slider" id="dogRot">
                <button type="button" id="dogAnimate">animate</button>
            </div>
            <div>
                <button onclick="help()">Help</button>
                <textarea readonly id="helpText" style="display:none">
Ini Help
                </textarea>
            </div>
        </div>
        
    </div>
</body>
</html>